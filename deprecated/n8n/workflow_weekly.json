{
  "name": "ì½˜í…ì¸  ì„¤ê³„ì ì±Œë¦°ì§€ - ì£¼ê°„ ì •ì‚° ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [{ "field": "weeks", "triggerAtDay": [0], "triggerAtHour": 23, "triggerAtMinute": 0 }]
        }
      },
      "id": "node_schedule",
      "name": "ë§¤ì£¼ ì¼ìš”ì¼ 23:00",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": { "__rl": true, "value": "={{$env.GOOGLE_SHEET_ID}}", "mode": "id" },
        "sheetName": { "__rl": true, "value": "Challenge_Log", "mode": "name" },
        "options": {}
      },
      "id": "node_read_sheets",
      "name": "ì´ë²ˆ ì£¼ ë°ì´í„° ì½ê¸°",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [460, 300],
      "credentials": {
        "googleSheetsOAuth2Api": { "id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Google Sheets" }
      }
    },
    {
      "parameters": {
        "jsCode": "const allRows = $input.all();\nconst now = new Date();\nconst weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n// ì´ë²ˆ ì£¼ ë°ì´í„° í•„í„°ë§\nconst thisWeekRows = allRows.filter(item => {\n  const rowDate = new Date(item.json['ë‚ ì§œ (Date)']);\n  return rowDate >= weekAgo && rowDate <= now;\n});\n\n// ì°¸ì—¬ìë³„ ì§‘ê³„\nconst stats = {};\nthisWeekRows.forEach(item => {\n  const name = item.json['ì‘ì„±ì (Name)'];\n  if (!stats[name]) stats[name] = { count: 0, platforms: [] };\n  stats[name].count++;\n  stats[name].platforms.push(item.json['í”Œë«í¼ (Platform)']);\n});\n\n// MVP ì„ ì •\nlet mvp = { name: '', count: 0 };\nObject.entries(stats).forEach(([name, data]) => {\n  if (data.count > mvp.count) mvp = { name, count: data.count };\n});\n\n// í˜„ì¬ ì£¼ì°¨ ê³„ì‚°\nconst startDate = new Date('2026-02-23');\nconst weekNumber = Math.ceil((now - startDate) / (7 * 24 * 60 * 60 * 1000));\n\n// ë©”ì‹œì§€ ìƒì„±\nconst participantList = Object.entries(stats)\n  .map(([name, data]) => `â€¢ ${name}: ${data.count}íšŒ (${[...new Set(data.platforms)].join(', ')})`)\n  .join('\\n');\n\nconst message = `**ğŸ“Š ${weekNumber}ì£¼ì°¨ ì±Œë¦°ì§€ ê²°ì‚°**\\n\\nì´ë²ˆ ì£¼ ì´ **${Object.keys(stats).length}ëª…**ì´ ì½˜í…ì¸  ìì‚°ì„ ìŒ“ì•˜ìŠµë‹ˆë‹¤!\\n\\n${participantList || 'ì´ë²ˆ ì£¼ ì¸ì¦ìê°€ ì—†ìŠµë‹ˆë‹¤.'}\\n\\nğŸ† **ì´ ì£¼ì˜ MVP**: ${mvp.name ? mvp.name + 'ë‹˜ (' + mvp.count + 'íšŒ ì¸ì¦!)' : 'í•´ë‹¹ ì—†ìŒ'}\\n\\në‹¤ìŒ ì£¼ë„ í•¨ê»˜ ì„±ì¥í•´ìš” ğŸ’ª`;\n\nreturn [{ json: { message, participant_count: Object.keys(stats).length, week_number: weekNumber } }];"
      },
      "id": "node_calc_summary",
      "name": "ì£¼ê°„ í†µê³„ ê³„ì‚°",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "content": "={{ $json.message }}",
        "channelId": "={{$env.DISCORD_CHANNEL_ID}}"
      },
      "id": "node_discord_weekly",
      "name": "Discord ì£¼ê°„ ê³µì§€",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [900, 300],
      "credentials": {
        "discordApi": { "id": "REPLACE_WITH_CREDENTIAL_ID", "name": "Discord Bot" }
      }
    }
  ],
  "connections": {
    "ë§¤ì£¼ ì¼ìš”ì¼ 23:00": {
      "main": [[ { "node": "ì´ë²ˆ ì£¼ ë°ì´í„° ì½ê¸°", "type": "main", "index": 0 } ]]
    },
    "ì´ë²ˆ ì£¼ ë°ì´í„° ì½ê¸°": {
      "main": [[ { "node": "ì£¼ê°„ í†µê³„ ê³„ì‚°", "type": "main", "index": 0 } ]]
    },
    "ì£¼ê°„ í†µê³„ ê³„ì‚°": {
      "main": [[ { "node": "Discord ì£¼ê°„ ê³µì§€", "type": "main", "index": 0 } ]]
    }
  },
  "settings": { "executionOrder": "v1" }
}
